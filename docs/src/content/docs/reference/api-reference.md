---
title: API Reference
description: API documentation for TypeSpec Events.
---

# API Reference

This section provides detailed documentation for the `@typespec-events/typespec` library and the `@typespec-events/runtime` package.

## `@typespec-events/typespec`

### `@event` Decorator

Marks a TypeSpec model as a tracking event.

```tsp
import "@typespec-events/typespec";

using TypespecEvents;

@event(name: string)
model MyEvent {
  // ... properties
}
```

*   **Target:** `Model`
*   **Parameters:**
    *   `name: string`: A string literal representing the name of the event. This name **must** be in `snake_case`. The emitter will use this name when generating the `eventSchemas` map.

**Example:**

```tsp
@event("user_logged_in")
model UserLoggedInEvent {
  userId: string;
}
```

### Emitter Options

The `@typespec-events/typespec` emitter can be configured via the `options` block in `tspconfig.yaml`.

```yaml
emit:
  - "@typespec-events/typespec"

options:
  "@typespec-events/typespec":
    # Your options go here
```

*   `output-dir`
    *   **Type:** `string`
    *   **Default:** `./tsp-output`
    *   **Description:** Specifies the directory where the generated code file (`events.zod.ts`) will be placed. The path is relative to the `tspconfig.yaml` file.
*   `schemaNamingConvention`
    *   **Type:** `string`
    *   **Default:** `"camelCase"`
    *   **Allowed values:** `"camelCase"`, `"PascalCase"`
    *   **Description:** Determines the naming convention used for the generated Zod schema variables and types.

## `@typespec-events/runtime`

### `defineTracker` Function

Defines a type-safe tracker function with optional Zod validation.

```ts
import { defineTracker, TypespecEventsError } from '@typespec-events/runtime';
import { eventSchemas } from './path/to/generated/events.zod'; // Adjust path

const track = defineTracker(options: DefineTrackerOptions): TypeSafeTrackFunction;
```

*   **Parameters:**
    *   `options: DefineTrackerOptions`: An object containing configuration options.
*   **Returns:** `TypeSafeTrackFunction`: A type-safe function to track events.

#### `DefineTrackerOptions` Interface

```ts
interface DefineTrackerOptions {
  track: UserTrackFunction;
  validation?: boolean;
  events: EventSchemas;
  onInvalidationError?: (error: TypespecEventsError) => void;
}
```

*   `track: UserTrackFunction`: Your actual tracking function that sends the event data to your analytics service. It takes the event name (string) and event properties (object) as arguments.
*   `validation?: boolean` (Optional): If `true` (default), enables runtime validation of event properties using Zod before calling the `track` function. If `false`, validation is skipped.
*   `events: EventSchemas`: The object mapping event names to Zod schemas, typically imported from the file generated by the `@typespec-events/typespec` emitter (`events.zod.ts`).
*   `onInvalidationError?: (error: TypespecEventsError) => void` (Optional): A callback function that is called when a validation error occurs or an invalid event name is provided. By default, it throws a `TypespecEventsError`.

#### `UserTrackFunction` Type

```ts
type UserTrackFunction = (eventName: string, eventProperties: Record<string, unknown>) => void;
```

Represents the signature of the function you provide to `defineTracker` to handle sending the event data.

#### `EventSchemas` Interface

```ts
interface EventSchemas {
  [eventName: string]: ZodObject;
}
```

Represents the structure of the object containing the generated Zod schemas, keyed by event name.

#### `TypeSafeTrackFunction` Type

```ts
type TypeSafeTrackFunction = <K extends keyof DefineTrackerOptions['events']>(
  eventName: K,
  eventProperties: z.infer<DefineTrackerOptions['events'][K]>,
) => void;
```

The type of the function returned by `defineTracker`. It provides type safety based on the `events` schemas provided in the options.

### `TypespecEventsError` Class

A custom error class thrown by `defineTracker` when validation fails or an invalid event name is used (if `onInvalidationError` is not provided or re-throws the error).

```ts
class TypespecEventsError extends Error {
  code: 'invalid_event_name' | 'invalid_event_properties';
  message: string;
  eventName: string;
  eventProperties: Record<string, unknown>;
  schema?: ZodObject;
  issues?: ZodIssue[];
}
```

*   `code`: Indicates the type of error (`'invalid_event_name'` or `'invalid_event_properties'`).
*   `message`: A descriptive error message.
*   `eventName`: The name of the event that caused the error.
*   `eventProperties`: The properties provided for the event.
*   `schema` (Optional): The Zod schema used for validation (present for `'invalid_event_properties'` errors).
*   `issues` (Optional): An array of Zod issues detailing the validation errors (present for `'invalid_event_properties'` errors).
